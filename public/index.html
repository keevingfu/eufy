<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eufy Robot Vacuum - Content-Driven Intelligent Growth Decision System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #2563eb;
      --secondary-color: #3b82f6;
      --background-color: #f8fafc;
      --card-bg: #ffffff;
      --text-color: #1e293b;
      --border-color: #e2e8f0;
      --hover-color: #dbeafe;
      --active-color: #bfdbfe;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Arial', 'Helvetica', sans-serif;
    }

    body {
      background-color: var(--background-color);
      color: var(--text-color);
      line-height: 1.6;
    }

    .container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 20px;
    }

    .logo {
      display: flex;
      align-items: center;
      font-size: 24px;
      font-weight: bold;
      color: var(--primary-color);
    }

    .logo img {
      height: 40px;
      margin-right: 10px;
    }

    .top-nav {
      display: flex;
      background-color: var(--card-bg);
      border-radius: 10px;
      box-shadow: var(--shadow);
      margin-bottom: 24px;
      overflow: hidden;
    }

    .nav-item {
      padding: 14px 18px;
      cursor: pointer;
      font-weight: 500;
      text-align: center;
      transition: all 0.3s ease;
      border-bottom: 3px solid transparent;
      white-space: nowrap;
    }

    .nav-item.active {
      color: var(--primary-color);
      border-bottom: 3px solid var(--primary-color);
      background-color: var(--active-color);
    }

    .nav-item:hover:not(.active) {
      background-color: var(--hover-color);
    }

    .module-submenu {
      display: flex;
      flex-wrap: wrap;
      background-color: var(--card-bg);
      border-radius: 10px;
      box-shadow: var(--shadow);
      margin-bottom: 24px;
      padding: 10px;
    }

    .submenu-item {
      padding: 8px 14px;
      margin: 5px;
      cursor: pointer;
      font-size: 14px;
      border-radius: 20px;
      background-color: var(--hover-color);
      transition: all 0.2s ease;
    }

    .submenu-item.active {
      background-color: var(--primary-color);
      color: white;
    }

    .submenu-item:hover:not(.active) {
      background-color: var(--active-color);
    }

    .search-container {
      margin-bottom: 24px;
    }

    .search-box {
      display: flex;
      margin-bottom: 12px;
    }

    .search-input {
      flex: 1;
      padding: 14px 20px;
      border: 2px solid var(--border-color);
      border-radius: 10px 0 0 10px;
      font-size: 16px;
      outline: none;
      transition: border-color 0.3s ease;
    }

    .search-input:focus {
      border-color: var(--primary-color);
    }

    .search-button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 0 10px 10px 0;
      padding: 0 24px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s ease;
    }

    .search-button:hover {
      background-color: var(--secondary-color);
    }

    .suggested-questions {
      margin-top: 20px;
    }

    .question-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }

    .question-card {
      background-color: var(--card-bg);
      border-radius: 10px;
      padding: 16px;
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .question-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .question-text {
      font-weight: 500;
    }

    .results-container {
      margin-top: 30px;
      display: none;
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .results-title {
      font-size: 22px;
      font-weight: bold;
    }

    .visualization-container {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
    }

    .chart-container {
      background-color: var(--card-bg);
      border-radius: 10px;
      padding: 20px;
      box-shadow: var(--shadow);
      height: 400px;
    }

    .insights-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .insight-card {
      background-color: var(--card-bg);
      border-radius: 10px;
      padding: 20px;
      box-shadow: var(--shadow);
    }

    .insight-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
      color: var(--primary-color);
    }

    .recommendations {
      margin-top: 10px;
    }

    .recommendation-item {
      display: flex;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .recommendation-item i {
      color: var(--primary-color);
      margin-right: 10px;
      margin-top: 4px;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 40px 0;
    }

    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top: 4px solid var(--primary-color);
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    /* Styles for thinking container */
    .thinking-container {
      margin-bottom: 24px;
      background-color: var(--card-bg);
      border-radius: 10px;
      padding: 20px;
      box-shadow: var(--shadow);
    }

    .thinking-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
      color: var(--primary-color);
    }

    .thinking-step {
      margin-bottom: 10px;
      padding: 10px;
      border-left: 3px solid var(--primary-color);
      background-color: var(--hover-color);
      border-radius: 0 5px 5px 0;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    /* Deep Search Styles */
    .deep-search-container {
      margin-top: 20px;
    }
    
    .section-title {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary-color);
      margin-bottom: 10px;
    }
    
    .section-description {
      color: var(--text-color);
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }
    
    .form-control {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 5px;
      background-color: var(--card-bg);
      color: var(--text-color);
      font-size: 14px;
    }
    
    textarea.form-control {
      resize: vertical;
      min-height: 100px;
    }
    
    .primary-button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      transition: background-color 0.3s ease;
      gap: 8px;
    }
    
    .primary-button:hover {
      background-color: var(--secondary-color);
    }
    
    .primary-button i {
      margin-right: 8px;
    }
    
    .secondary-button {
      background-color: var(--hover-color);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 12px;
    }
    
    .secondary-button:hover {
      background-color: var(--active-color);
    }
    
    .preset-tasks {
      margin-bottom: 12px;
    }
    
    .result-container {
      background-color: var(--hover-color);
      border-radius: 5px;
      padding: 15px;
      margin-top: 10px;
      margin-bottom: 15px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .code-block {
      background-color: #1e293b;
      color: #f8fafc;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
      font-family: monospace;
      margin-bottom: 10px;
    }
    
    .history-container {
      max-height: 300px;
      overflow-y: auto;
    }
    
    .history-item {
      padding: 12px;
      border-bottom: 1px solid var(--border-color);
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    
    .history-item:hover {
      background-color: var(--hover-color);
    }
    
    .note-box {
      background-color: var(--hover-color);
      border-left: 4px solid var(--primary-color);
      padding: 12px;
      margin: 15px 0;
      border-radius: 4px;
    }
    
    /* Research Module Styles */
    .research-container {
      margin-bottom: 24px;
    }
    
    .research-tabs {
      display: flex;
      flex-wrap: wrap;
      background-color: var(--card-bg);
      border-radius: 10px 10px 0 0;
      box-shadow: var(--shadow);
      margin-bottom: 0;
      border-bottom: 1px solid var(--border-color);
      overflow-x: auto;
    }
    
    .tab {
      padding: 14px 18px;
      cursor: pointer;
      font-weight: 500;
      text-align: center;
      transition: all 0.3s ease;
      border-bottom: 3px solid transparent;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .tab.active {
      color: var(--primary-color);
      border-bottom: 3px solid var(--primary-color);
      background-color: var(--active-color);
    }
    
    .tab:hover:not(.active) {
      background-color: var(--hover-color);
    }
    
    .tab-content {
      background-color: var(--card-bg);
      border-radius: 0 0 10px 10px;
      box-shadow: var(--shadow);
      padding: 20px;
      margin-bottom: 24px;
    }
    
    .form-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .form-separator {
      font-size: 18px;
      color: var(--text-color);
    }
    
    .recordings-list {
      max-height: 400px;
      overflow-y: auto;
    }
    
    .recording-item {
      padding: 12px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .recording-item:hover {
      background-color: var(--hover-color);
    }
    
    .recording-info {
      flex: 1;
    }
    
    .recording-title {
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .recording-meta {
      font-size: 12px;
      color: #64748b;
    }
    
    .recording-actions {
      display: flex;
      gap: 8px;
    }
    
    .analysis-result {
      margin-top: 15px;
    }
    
    .analysis-result h5 {
      margin-top: 20px;
      margin-bottom: 10px;
      color: var(--primary-color);
      font-size: 16px;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 5px;
    }
    
    .analysis-result ul {
      margin-left: 20px;
      margin-bottom: 15px;
    }
    
    .analysis-result li {
      margin-bottom: 5px;
    }
    
    .history-item:last-child {
      border-bottom: none;
    }
    
    .history-item-title {
      font-weight: 500;
      margin-bottom: 5px;
    }
    
    .history-item-meta {
      font-size: 12px;
      color: #64748b;
      display: flex;
      justify-content: space-between;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .top-nav {
        flex-wrap: wrap;
      }
      .nav-item {
        flex-basis: 33.33%;
      }
      .visualization-container {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .nav-item {
        flex-basis: 50%;
      }
      .question-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header class="header">
      <div class="logo">
        <img src="eufy_logo.png" alt="Eufy Logo" />
        Eufy Content-Driven Growth Decision System
      </div>
    </header>

    <nav class="top-nav">
      <div class="nav-item active" data-module="overview">Overview</div>
      <div class="nav-item" data-module="insight">Insight</div>
      <div class="nav-item" data-module="koc">KOC & KOL</div>
      <div class="nav-item" data-module="feeds">Content Distribution</div>
      <div class="nav-item" data-module="private">Private Domain</div>
      <div class="nav-item" data-module="deepsearch">Deep Search</div>
      <div class="nav-item" data-module="research">Research</div>
    </nav>

    <div class="module-submenu" id="module-submenu">
      <!-- Submenu items will be dynamically generated based on selected module -->
    </div>

    <div class="module-content" id="module-content">
      <!-- Module content will be dynamically loaded here -->
    </div>

    <!-- Deep Search Module Content -->
    <div class="deep-search-container" id="deep-search-container" style="display: none;">
      <h2 class="section-title">AI-Powered Deep Search</h2>
      <p class="section-description">Use advanced AI to search and analyze information from the web.</p>
      
      <div class="card">
        <h3 class="card-title">Create New Search Task</h3>
        <div class="form-group">
          <label for="taskInput">Task Description:</label>
          <textarea id="taskInput" class="form-control" rows="4" placeholder="Example: Research the latest trends in robot vacuum technology and compare the top 5 models in terms of features and price."></textarea>
          <div class="preset-tasks">
            <button id="eufyAnalysisBtn" class="secondary-button">
              <i class="fas fa-broom"></i> Eufy Social Media Analysis
            </button>
          </div>
        </div>
        <div class="form-group">
          <label for="modelSelect">AI Model:</label>
          <select id="modelSelect" class="form-control">
            <option value="gpt-4o">OpenAI - GPT-4o</option>
            <option value="gemini-pro">Google - Gemini Pro</option>
            <option value="deepseek-v3">DeepSeek - V3</option>
          </select>
        </div>
        <button id="runTaskBtn" class="primary-button">
          <i class="fas fa-robot"></i> Run Task
        </button>
      </div>
      
      <div class="card" id="resultCard" style="display: none;">
        <h3 class="card-title">Task Results</h3>
        <div id="taskResult" class="result-container">
          <p>Results will appear here...</p>
        </div>
        <div class="code-container" id="codeContainer" style="display: none;">
          <h4>Generated Code</h4>
          <pre id="generatedCode" class="code-block"></pre>
          <button id="copyCodeBtn" class="secondary-button">
            <i class="fas fa-copy"></i> Copy Code
          </button>
        </div>
      </div>
      
      <div class="card">
        <h3 class="card-title">Task History</h3>
        <div id="taskHistory" class="history-container">
          <p>No task history yet.</p>
        </div>
      </div>
    </div>

    <!-- Research Module Content -->
    <div class="research-container" id="research-container" style="display: none;">
      <h2 class="section-title">AI-Powered Research</h2>
      <p class="section-description">Use AI to control your browser and perform complex research tasks.</p>
      
      <div class="research-tabs">
        <div class="tab active" data-tab="agent-settings"><i class="fas fa-wrench"></i> Agent Settings</div>
        <div class="tab" data-tab="llm-settings"><i class="fas fa-globe"></i> LLM Settings</div>
        <div class="tab" data-tab="browser-settings"><i class="fas fa-robot"></i> Browser Settings</div>
        <div class="tab" data-tab="run-agent"><i class="fas fa-search"></i> Run Agent</div>
        <div class="tab" data-tab="deep-research"><i class="fas fa-microscope"></i> Deep Research</div>
        <div class="tab" data-tab="recordings"><i class="fas fa-video"></i> Recordings</div>
      </div>
      
      <!-- Agent Settings Tab Content -->
      <div class="tab-content" id="agent-settings-content">
        <div class="card">
          <h3 class="card-title">Agent Configuration</h3>
          <div class="form-group">
            <label for="agentMode">Agent Mode:</label>
            <select id="agentMode" class="form-control">
              <option value="default">Default Mode (Browser closes after task)</option>
              <option value="persistent">Persistent Mode (Browser stays open)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="agentTimeout">Task Timeout (seconds):</label>
            <input type="number" id="agentTimeout" class="form-control" value="300" min="60" max="1800">
          </div>
          <div class="form-group">
            <label for="agentMaxSteps">Maximum Steps:</label>
            <input type="number" id="agentMaxSteps" class="form-control" value="15" min="5" max="50">
          </div>
          <button id="saveAgentSettingsBtn" class="primary-button">
            <i class="fas fa-save"></i> Save Settings
          </button>
        </div>
      </div>
      
      <!-- LLM Settings Tab Content -->
      <div class="tab-content" id="llm-settings-content" style="display: none;">
        <div class="card">
          <h3 class="card-title">Language Model Settings</h3>
          <div class="form-group">
            <label for="defaultLLM">Default LLM Provider:</label>
            <select id="defaultLLM" class="form-control">
              <option value="openai">OpenAI</option>
              <option value="google">Google</option>
              <option value="deepseek">DeepSeek</option>
              <option value="anthropic">Anthropic</option>
              <option value="mistral">Mistral</option>
            </select>
          </div>
          <div class="form-group">
            <label for="defaultModel">Default Model:</label>
            <select id="defaultModel" class="form-control">
              <option value="gpt-4o">GPT-4o</option>
              <option value="gemini-pro">Gemini Pro</option>
              <option value="deepseek-v3">DeepSeek V3</option>
              <option value="claude-3-opus">Claude 3 Opus</option>
              <option value="mistral-large">Mistral Large</option>
            </select>
          </div>
          <div class="form-group">
            <label for="temperature">Temperature:</label>
            <input type="range" id="temperature" class="form-control" min="0" max="1" step="0.1" value="0.7">
            <span id="temperatureValue">0.7</span>
          </div>
          <button id="saveLLMSettingsBtn" class="primary-button">
            <i class="fas fa-save"></i> Save Settings
          </button>
        </div>
      </div>
      
      <!-- Browser Settings Tab Content -->
      <div class="tab-content" id="browser-settings-content" style="display: none;">
        <div class="card">
          <h3 class="card-title">Browser Configuration</h3>
          <div class="form-group">
            <label for="browserType">Browser Type:</label>
            <select id="browserType" class="form-control">
              <option value="chromium">Chromium</option>
              <option value="firefox">Firefox</option>
              <option value="webkit">WebKit</option>
            </select>
          </div>
          <div class="form-group">
            <label for="headless">Headless Mode:</label>
            <select id="headless" class="form-control">
              <option value="false">Disabled (Show browser window)</option>
              <option value="true">Enabled (Hide browser window)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="userAgent">User Agent:</label>
            <input type="text" id="userAgent" class="form-control" placeholder="Default">
          </div>
          <div class="form-group">
            <label for="viewportSize">Viewport Size:</label>
            <div class="form-row">
              <input type="number" id="viewportWidth" class="form-control" value="1920" min="800" max="3840" placeholder="Width">
              <span class="form-separator">Ã—</span>
              <input type="number" id="viewportHeight" class="form-control" value="1080" min="600" max="2160" placeholder="Height">
            </div>
          </div>
          <button id="saveBrowserSettingsBtn" class="primary-button">
            <i class="fas fa-save"></i> Save Settings
          </button>
        </div>
      </div>
      
      <!-- Run Agent Tab Content -->
      <div class="tab-content" id="run-agent-content" style="display: none;">
        <div class="card">
          <h3 class="card-title">Run Browser Agent</h3>
          <div class="form-group">
            <label for="agentTask">Task Description:</label>
            <textarea id="agentTask" class="form-control" rows="4" placeholder="Describe what you want the agent to do. For example: 'Search for the latest robot vacuum reviews and summarize the top 3 models'"></textarea>
          </div>
          <div class="form-group">
            <label for="agentModel">AI Model:</label>
            <select id="agentModel" class="form-control">
              <option value="gpt-4o">OpenAI - GPT-4o</option>
              <option value="gemini-pro">Google - Gemini Pro</option>
              <option value="deepseek-v3">DeepSeek - V3</option>
              <option value="claude-3-opus">Anthropic - Claude 3 Opus</option>
              <option value="mistral-large">Mistral - Large</option>
            </select>
          </div>
          <button id="runAgentBtn" class="primary-button">
            <i class="fas fa-play"></i> Run Agent
          </button>
        </div>
        
        <div class="card" id="agentResultCard" style="display: none;">
          <h3 class="card-title">Agent Results</h3>
          <div id="agentResult" class="result-container">
            <p>Results will appear here...</p>
          </div>
        </div>
      </div>
      
      <!-- Deep Research Tab Content -->
      <div class="tab-content" id="deep-research-content" style="display: none;">
        <div class="card">
          <h3 class="card-title">Deep Research</h3>
          <div class="form-group">
            <label for="researchTopic">Research Topic:</label>
            <textarea id="researchTopic" class="form-control" rows="4" placeholder="Enter a complex research topic. For example: 'Analyze the impact of AI on e-commerce product recommendations in the last 2 years'"></textarea>
          </div>
          <div class="form-group">
            <label for="researchDepth">Research Depth:</label>
            <select id="researchDepth" class="form-control">
              <option value="basic">Basic (Quick overview)</option>
              <option value="standard">Standard (Comprehensive analysis)</option>
              <option value="deep">Deep (Exhaustive investigation)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="researchModel">AI Model:</label>
            <select id="researchModel" class="form-control">
              <option value="gpt-4o">OpenAI - GPT-4o</option>
              <option value="claude-3-opus">Anthropic - Claude 3 Opus</option>
            </select>
          </div>
          <button id="startResearchBtn" class="primary-button">
            <i class="fas fa-microscope"></i> Start Research
          </button>
        </div>
        
        <div class="card" id="researchResultCard" style="display: none;">
          <h3 class="card-title">Research Results</h3>
          <div id="researchResult" class="result-container">
            <p>Research results will appear here...</p>
          </div>
        </div>
      </div>
      
      <!-- Recordings Tab Content -->
      <div class="tab-content" id="recordings-content" style="display: none;">
        <div class="card">
          <h3 class="card-title">Browser Session Recordings</h3>
          <div class="recordings-list" id="recordingsList">
            <p>No recordings available.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="search-container">
      <div class="search-box">
        <input type="text" class="search-input" placeholder="Enter your question, e.g.: Which content performs best on YouTube?" />
        <button class="search-button">
          <i class="fas fa-search"></i> Search
        </button>
      </div>
    </div>

    <div class="suggested-questions">
      <h2>Recommended Questions</h2>
      <div class="question-grid" id="suggested-questions-grid">
        <!-- Questions will be dynamically generated -->
      </div>
    </div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Analyzing data, please wait...</p>
    </div>

    <div class="results-container" id="results-container">
      <div class="results-header">
        <div class="results-title" id="results-title">Query Results</div>
      </div>

      <div class="visualization-container">
        <div class="chart-container" id="chart-container">
          <!-- Chart will be displayed here -->
        </div>

        <div class="insights-container">
          <div class="insight-card">
            <div class="insight-title">Key Insights</div>
            <div id="insights-content">
              <!-- Insights will be displayed here -->
            </div>
          </div>

          <div class="insight-card">
            <div class="insight-title">Recommended Actions</div>
            <div class="recommendations" id="recommendations-content">
              <!-- Recommendations will be displayed here -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Import chart library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
  
  <!-- Import question data -->
  <script src="data/question_results_data.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize variables
      let currentModule = 'overview';
      let currentSubModule = 'overview-dashboard';
      let chartInstance = null;
      let thinkingSteps = [];
      let currentThinkingStep = 0;
      let thinkingInterval = null;

      // Get DOM elements
      const navItems = document.querySelectorAll('.nav-item');
      const moduleSubmenu = document.getElementById('module-submenu');
      const searchInput = document.querySelector('.search-input');
      const searchButton = document.querySelector('.search-button');
      const suggestedQuestionsGrid = document.getElementById('suggested-questions-grid');
      const loadingElement = document.getElementById('loading');
      const resultsContainer = document.getElementById('results-container');
      const resultsTitle = document.getElementById('results-title');
      const chartContainer = document.getElementById('chart-container');
      const insightsContent = document.getElementById('insights-content');
      const recommendationsContent = document.getElementById('recommendations-content');

      // Module submenus
      const moduleSubmenus = {
        overview: [
          { id: 'overview-dashboard', label: 'Dashboard' },
          { id: 'overview-kpi', label: 'Key Metrics' },
          { id: 'overview-roi', label: 'ROI Analysis' },
          { id: 'overview-trends', label: 'Trends' }
        ],
        insight: [
          { id: 'insight-search', label: 'Search Insights' },
          { id: 'insight-voc', label: 'VOC Analysis' },
          { id: 'insight-viral', label: 'Viral Videos' },
          { id: 'insight-factors', label: 'Viral Factors' }
        ],
        koc: [
          { id: 'koc-trends', label: 'Content Trends' },
          { id: 'koc-youtube', label: 'YouTube Trends' },
          { id: 'koc-instagram', label: 'Instagram Trends' },
          { id: 'koc-tiktok', label: 'TikTok Trends' },
          { id: 'koc-paid', label: 'Paid KOL' },
          { id: 'koc-self', label: 'Self-Operated KOC' },
          { id: 'koc-user', label: 'User Journey' },
          { id: 'koc-search', label: 'Search Performance' }
        ],
        feeds: [
          { id: 'feeds-effectiveness', label: 'Ad Effectiveness' },
          { id: 'feeds-campaigns', label: 'Campaign Performance' },
          { id: 'feeds-channel', label: 'Channel Analysis' },
          { id: 'feeds-google', label: 'Google Ads' },
          { id: 'feeds-facebook', label: 'Facebook Ads' },
          { id: 'feeds-amazon', label: 'Amazon Ads' },
          { id: 'feeds-product', label: 'Product Performance' }
        ],
        private: [
          { id: 'private-landing', label: 'Landing Pages' },
          { id: 'private-tags', label: 'Page Tags' },
          { id: 'private-whatsapp', label: 'WhatsApp Groups' },
          { id: 'private-email', label: 'Email Marketing' },
          { id: 'private-dtc', label: 'DTC Website' }
        ]
      };

      // Module questions for fallback
      const moduleQuestions = {
        overview: [
          "How are our social media marketing campaigns performing overall?",
          "What are the key metrics across all marketing channels?",
          "What is the ROI of content across different platforms?",
          "How have our key performance indicators changed over the last quarter?",
          "Which content types perform best across all channels?",
          "What is our overall conversion rate trend for the past year?",
          "How does our content performance compare to industry benchmarks?",
          "What is the cost-effectiveness of our various marketing efforts?"
        ],
        insight: [
          "What are the current trending search terms for robot vacuums?",
          "Show me the sentiment analysis of customer reviews",
          "Which video content has gone viral in our industry recently?",
          "What factors contribute to viral content in the robot vacuum space?",
          "What are the most common user complaints about our products?",
          "What search terms have shown the biggest growth in the last quarter?",
          "How do seasonal trends affect search behavior for our products?",
          "What product features are most frequently mentioned in positive reviews?"
        ],
        koc: [
          "Show me content trends on YouTube for robot vacuums",
          "Which Instagram influencers have the highest engagement rate?",
          "How is our self-operated KOC content performing?",
          "What is the typical user journey for our products?",
          "How do our products rank in search results compared to competitors?",
          "Which content formats drive the most engagement on TikTok?",
          "What is the ROI comparison between micro and macro influencers?",
          "How has the content landscape evolved over the past year?"
        ],
        feeds: [
          "How effective are our ad campaigns across all platforms?",
          "What is the performance of our Google Ad campaigns?",
          "Which sales channels are driving the most conversions?",
          "How is our product performance on Amazon?",
          "What is our ROI on Facebook advertising?",
          "How do our conversion rates vary between platforms?",
          "Which ad creative formats have the highest CTR?",
          "What is the customer acquisition cost for each channel?"
        ],
        private: [
          "How are our landing pages performing?",
          "What content generates the most engagement in our WhatsApp groups?",
          "How effective is our email marketing campaign?",
          "What is the traffic source breakdown for our DTC website?",
          "Which customer segments show the highest engagement with our content?",
          "What is the retention rate of our email subscribers?",
          "How do content tags affect landing page performance?",
          "What is the relationship between private domain engagement and conversion?"
        ]
      };

      // Event listeners for navigation
      navItems.forEach(item => {
        item.addEventListener('click', function() {
          const module = this.dataset.module;
          
          // Update active state
          navItems.forEach(el => el.classList.remove('active'));
          this.classList.add('active');
          
          // Update current module
          currentModule = module;
          
          // Hide all module containers
          moduleContent.style.display = 'none';
          deepSearchContainer.style.display = 'none';
          researchContainer.style.display = 'none';
          document.querySelector('.search-container').style.display = 'none';
          document.querySelector('.suggested-questions').style.display = 'none';
          document.querySelector('.module-submenu').style.display = 'none';
          
          // Show appropriate content based on module
          if (module === 'deepsearch') {
            deepSearchContainer.style.display = 'block';
          } else if (module === 'research') {
            researchContainer.style.display = 'block';
          } else {
            moduleContent.style.display = 'block';
            document.querySelector('.search-container').style.display = 'flex';
            document.querySelector('.suggested-questions').style.display = 'block';
            document.querySelector('.module-submenu').style.display = 'flex';
            
            // Update submenu and questions
            updateSubmenu(module);
            updateQuestions(module, currentSubModule);
          }
        });
      });

      // Search on Enter key
      searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          handleSearch();
        }
      });

      // Search button click
      searchButton.addEventListener('click', handleSearch);

      // Update submenu based on selected module
      function updateSubmenu(module) {
        moduleSubmenu.innerHTML = '';
        
        moduleSubmenus[module].forEach(item => {
          const submenuItem = document.createElement('div');
          submenuItem.className = 'submenu-item';
          submenuItem.textContent = item.label;
          submenuItem.dataset.id = item.id;
          
          if (item.id === module + '-dashboard' || moduleSubmenus[module].indexOf(item) === 0) {
            submenuItem.classList.add('active');
            currentSubModule = item.id;
          }
          
          submenuItem.addEventListener('click', function() {
            document.querySelectorAll('.submenu-item').forEach(el => el.classList.remove('active'));
            this.classList.add('active');
            currentSubModule = this.dataset.id;
            updateQuestions(currentModule, currentSubModule);
          });
          
          moduleSubmenu.appendChild(submenuItem);
        });
      }

      // Update suggested questions based on selected module and submodule
      function updateQuestions(module, subModule) {
        suggestedQuestionsGrid.innerHTML = '';
        
        // Get questions from the data file for this module/submodule
        if (questionResultsData && questionResultsData[module] && questionResultsData[module][subModule]) {
          const questions = questionResultsData[module][subModule];
          
          questions.forEach(questionData => {
            const questionCard = document.createElement('div');
            questionCard.className = 'question-card';
            questionCard.innerHTML = `<div class="question-text">${questionData.question}</div>`;
            
            questionCard.addEventListener('click', function() {
              searchInput.value = questionData.question;
              handleSearch(questionData.question);
            });
            
            suggestedQuestionsGrid.appendChild(questionCard);
          });
        } else {
          // If no specific questions for this submodule, show default module questions
          const defaultQuestions = moduleQuestions[module] || [];
          
          defaultQuestions.forEach(question => {
            const questionCard = document.createElement('div');
            questionCard.className = 'question-card';
            questionCard.innerHTML = `<div class="question-text">${question}</div>`;
            
            questionCard.addEventListener('click', function() {
              searchInput.value = question;
              handleSearch(question);
            });
            
            suggestedQuestionsGrid.appendChild(questionCard);
          });
        }
      }

      // Display sequential thinking process
      function showThinkingProcess(steps) {
        // Create thinking container if it doesn't exist
        if (!document.getElementById('thinking-container')) {
          const thinkingContainer = document.createElement('div');
          thinkingContainer.id = 'thinking-container';
          thinkingContainer.className = 'thinking-container';
          
          const thinkingTitle = document.createElement('div');
          thinkingTitle.className = 'thinking-title';
          thinkingTitle.textContent = 'Analysis Process';
          
          const thinkingContent = document.createElement('div');
          thinkingContent.id = 'thinking-content';
          thinkingContent.className = 'thinking-content';
          
          thinkingContainer.appendChild(thinkingTitle);
          thinkingContainer.appendChild(thinkingContent);
          
          // Insert after loading and before results
          loadingElement.insertAdjacentElement('afterend', thinkingContainer);
        }
        
        const thinkingContent = document.getElementById('thinking-content');
        thinkingContent.innerHTML = '';
        thinkingSteps = steps;
        currentThinkingStep = 0;
        
        // Create step elements but hide them initially
        thinkingSteps.forEach((step, index) => {
          const stepElement = document.createElement('div');
          stepElement.className = 'thinking-step';
          stepElement.innerHTML = `
            <div style="font-weight: bold; margin-bottom: 5px;">Step ${step.step}</div>
            <div>${step.thought}</div>
          `;
          
          thinkingContent.appendChild(stepElement);
        });
        
        // Show the thinking container
        document.getElementById('thinking-container').style.display = 'block';
        
        // Animate the thinking steps
        if (thinkingInterval) clearInterval(thinkingInterval);
        
        thinkingInterval = setInterval(() => {
          if (currentThinkingStep < thinkingSteps.length) {
            const stepElement = thinkingContent.children[currentThinkingStep];
            stepElement.style.opacity = '1';
            currentThinkingStep++;
          } else {
            clearInterval(thinkingInterval);
            // Show results after thinking is complete
            setTimeout(() => {
              resultsContainer.style.display = 'block';
            }, 1000);
          }
        }, 1500);
      }

      // Handle search action
      function handleSearch(query = '') {
        if (!query) {
          query = searchInput.value.trim();
        }
        
        if (!query) return;
        
        // Show loading state
        loadingElement.style.display = 'block';
        resultsContainer.style.display = 'none';
        
        // Hide any existing thinking container
        const existingThinking = document.getElementById('thinking-container');
        if (existingThinking) existingThinking.style.display = 'none';
        
        // Search for the question in the data
        let questionData = null;
        
        // Search in all modules and submodules
        if (questionResultsData) {
          for (const module in questionResultsData) {
            for (const submodule in questionResultsData[module]) {
              const questions = questionResultsData[module][submodule];
              const found = questions.find(q => q.question === query);
              if (found) {
                questionData = found;
                break;
              }
            }
            if (questionData) break;
          }
        }
        
        // If found in data file, use that
        if (questionData) {
          setTimeout(() => {
            // Hide loading, show thinking
            loadingElement.style.display = 'none';
            
            // Display thinking process first
            if (questionData.thinking_steps && questionData.thinking_steps.length > 0) {
              showThinkingProcess(questionData.thinking_steps);
            } else {
              // If no thinking steps, show results directly
              resultsContainer.style.display = 'block';
            }
            
            // Update results
            resultsTitle.textContent = questionData.result.chartTitle || 'Results';
            renderChart(questionData.result.data, questionData.result.chartType, questionData.result.chartTitle);
            renderInsights(questionData.result.insights);
            renderRecommendations(questionData.result.recommendations);
          }, 1500);
        } else {
          // Fall back to mock data
          fetchData(query, currentModule, currentSubModule)
            .then(result => {
              // Hide loading state
              loadingElement.style.display = 'none';
              resultsContainer.style.display = 'block';
              
              // Update results
              resultsTitle.textContent = result.chartTitle || 'Results';
              renderChart(result.data, result.chartType, result.chartTitle);
              renderInsights(result.insights);
              renderRecommendations(result.recommendations);
            });
        }
      }

      // Render chart using ECharts
      function renderChart(data, chartType, title) {
        // Clear previous chart
        if (chartInstance) {
          chartInstance.dispose();
        }
        
        // Initialize chart
        chartInstance = echarts.init(chartContainer);
        
        // Prepare chart options based on type
        let options = {};
        
        if (chartType === 'bar') {
          const xAxisData = data.map(item => {
            return item.platform || item.category || item.term || item.campaign || item.page || item.channel || Object.keys(item)[0];
          });
          
          const seriesData = [];
          const metrics = [];
          
          // Extract series data
          if (data.length > 0) {
            const firstItem = data[0];
            const excludeKeys = ['platform', 'category', 'term', 'campaign', 'page', 'channel', 'date', 'sentiment', 'factor', 'name'];
            
            Object.keys(firstItem).forEach(key => {
              if (!excludeKeys.includes(key)) {
                metrics.push(key);
                seriesData.push({
                  name: key,
                  type: 'bar',
                  data: data.map(item => item[key])
                });
              }
            });
          }
          
          options = {
            title: {
              text: title,
              left: 'center'
            },
            tooltip: {
              trigger: 'axis',
              axisPointer: {
                type: 'shadow'
              }
            },
            legend: {
              data: metrics,
              bottom: 0
            },
            grid: {
              left: '3%',
              right: '4%',
              bottom: '10%',
              top: '15%',
              containLabel: true
            },
            xAxis: {
              type: 'category',
              data: xAxisData,
              axisLabel: {
                rotate: 45,
                interval: 0
              }
            },
            yAxis: {
              type: 'value'
            },
            series: seriesData
          };
        } else if (chartType === 'line') {
          const xAxisData = data.map(item => item.date);
          const seriesData = [];
          const metrics = [];
          
          // Extract series data
          if (data.length > 0) {
            const firstItem = data[0];
            const excludeKeys = ['date'];
            
            Object.keys(firstItem).forEach(key => {
              if (!excludeKeys.includes(key)) {
                metrics.push(key);
                seriesData.push({
                  name: key,
                  type: 'line',
                  data: data.map(item => item[key])
                });
              }
            });
          }
          
          options = {
            title: {
              text: title,
              left: 'center'
            },
            tooltip: {
              trigger: 'axis'
            },
            legend: {
              data: metrics,
              bottom: 0
            },
            grid: {
              left: '3%',
              right: '4%',
              bottom: '10%',
              top: '15%',
              containLabel: true
            },
            xAxis: {
              type: 'category',
              data: xAxisData,
              axisLabel: {
                rotate: 45,
                interval: 0
              }
            },
            yAxis: {
              type: 'value'
            },
            series: seriesData
          };
        } else if (chartType === 'pie') {
          const pieData = data.map(item => {
            const name = item.sentiment || item.channel || item.source || Object.keys(item)[0];
            const value = item.value || item.traffic || item.revenue || Object.values(item)[1];
            return { name, value };
          });
          
          options = {
            title: {
              text: title,
              left: 'center'
            },
            tooltip: {
              trigger: 'item',
              formatter: '{a} <br/>{b}: {c} ({d}%)'
            },
            legend: {
              orient: 'vertical',
              right: 10,
              top: 'center',
              data: pieData.map(item => item.name)
            },
            series: [
              {
                name: 'Data',
                type: 'pie',
                radius: ['50%', '70%'],
                avoidLabelOverlap: false,
                label: {
                  show: false,
                  position: 'center'
                },
                emphasis: {
                  label: {
                    show: true,
                    fontSize: '16',
                    fontWeight: 'bold'
                  }
                },
                labelLine: {
                  show: false
                },
                data: pieData
              }
            ]
          };
        } else if (chartType === 'radar') {
          const indicators = data.map(item => {
            const name = item.factor || Object.keys(item)[0];
            return { name, max: 100 };
          });
          
          const seriesData = [
            {
              value: data.map(item => item.score || Object.values(item)[1]),
              name: 'Score'
            }
          ];
          
          options = {
            title: {
              text: title,
              left: 'center'
            },
            tooltip: {
              trigger: 'item'
            },
            radar: {
              indicator: indicators
            },
            series: [
              {
                type: 'radar',
                data: seriesData
              }
            ]
          };
        } else if (chartType === 'scatter') {
          const seriesData = data.map(item => {
            return [item.followers, item.engagement, item.name, item.cost];
          });
          
          options = {
            title: {
              text: title,
              left: 'center'
            },
            tooltip: {
              trigger: 'item',
              formatter: function(params) {
                return `${params.data[2]}<br/>Followers: ${params.data[0]}<br/>Engagement: ${params.data[1]}%<br/>Cost: $${params.data[3]}`;
              }
            },
            xAxis: {
              type: 'value',
              name: 'Followers',
              axisLabel: {
                formatter: function(value) {
                  return value >= 1000000 ? (value / 1000000).toFixed(1) + 'M' : (value / 1000).toFixed(0) + 'K';
                }
              }
            },
            yAxis: {
              type: 'value',
              name: 'Engagement Rate (%)'
            },
            series: [
              {
                type: 'scatter',
                symbolSize: function(data) {
                  // Size based on cost
                  return Math.sqrt(data[3]) / 10;
                },
                data: seriesData
              }
            ]
          };
        }
        
        // Set options and render
        chartInstance.setOption(options);
        
        // Handle resize
        window.addEventListener('resize', function() {
          chartInstance.resize();
        });
      }

      // Render insights
      function renderInsights(insights) {
        insightsContent.innerHTML = '';
        
        if (!insights || insights.length === 0) {
          insightsContent.innerHTML = '<p>No insights available.</p>';
          return;
        }
        
        insights.forEach(insight => {
          const insightEl = document.createElement('div');
          insightEl.className = 'insight-item';
          insightEl.innerHTML = `
            <h4 style="font-weight: bold; margin-bottom: 5px;">${insight.title}</h4>
            <p>${insight.description}</p>
          `;
          insightsContent.appendChild(insightEl);
        });
      }

      // Render recommendations
      function renderRecommendations(recommendations) {
        recommendationsContent.innerHTML = '';
        
        if (!recommendations || recommendations.length === 0) {
          recommendationsContent.innerHTML = '<p>No recommendations available.</p>';
          return;
        }
        
        recommendations.forEach(recommendation => {
          const recEl = document.createElement('div');
          recEl.className = 'recommendation-item';
          recEl.innerHTML = `
            <i class="fas fa-check-circle"></i>
            <span>${recommendation}</span>
          `;
          recommendationsContent.appendChild(recEl);
        });
      }

      // Mock API call
      async function fetchData(query, module, subModule) {
        // This should be an actual API call in production
        // Using mock data for now
        return new Promise((resolve) => {
          setTimeout(() => {
            let result = generateMockData(query, module, subModule);
            resolve(result);
          }, 1500); // Simulate network delay
        });
      }

      // Generate mock data
      function generateMockData(query, module, subModule) {
        let data, chartType, chartTitle, insights, recommendations;

        // Based on module and query generate different mock data
        if (module === 'overview') {
          if (query.includes('ROI') || query.includes('roi')) {
            data = [
              { platform: 'YouTube', roi: 3.2 },
              { platform: 'Instagram', roi: 2.7 },
              { platform: 'TikTok', roi: 4.1 },
              { platform: 'Facebook', roi: 2.3 },
              { platform: 'Google', roi: 3.8 }
            ];
            chartType = 'bar';
            chartTitle = 'Content ROI by Platform';
            insights = [
              { title: 'Highest ROI', description: 'TikTok platform shows the highest ROI at 4.1, 25% above average.' },
              { title: 'ROI Variability', description: 'Significant ROI variability across social media platforms, with a 43% difference between highest and lowest.' }
            ];
            recommendations = [
              'Increase content investment on TikTok for higher returns',
              'Analyze Facebook\'s underperformance and adjust content strategy',
              'Optimize existing YouTube content to improve ROI potential'
            ];
          } else {
            // Default overview data
            data = [];
            // Date range from March 1, 2025 to April 1, 2025
            const dates = ['2025-03-01', '2025-03-05', '2025-03-10', '2025-03-15', '2025-03-20', '2025-03-25', '2025-03-31'];
            
            dates.forEach(date => {
              data.push({
                date: date,
                impressions: Math.round(Math.random() * 100000 + 50000),
                clicks: Math.round(Math.random() * 10000 + 5000),
                conversions: Math.round(Math.random() * 1000 + 500)
              });
            });
            chartType = 'line';
            chartTitle = '2025.3.1-2025.4.1 Social Media Performance Trend';
            insights = [
              { title: 'Impression Growth', description: 'During March 2025, total impressions grew by 15%, indicating improved brand awareness in the spring season.' },
              { title: 'Conversion Rate Improvement', description: 'Conversion rate significantly improved in the last week of March 2025, from 1.3% to 1.9%.' }
            ];
            recommendations = [
              'Continue expanding content reach to increase brand exposure in April 2025',
              'Analyze factors behind late March conversion rate improvement and apply to April campaigns',
              'Focus on top-performing platforms to maximize ROI for Q2 2025'
            ];
          }
        } else if (module === 'insight') {
          // Insight module mock data
          data = [
            { term: 'Robot vacuum pet hair', volume: 22500, growth: 18 },
            { term: 'Best robot vacuum', volume: 18700, growth: 5 },
            { term: 'Robot vacuum with mop', volume: 16200, growth: 32 },
            { term: 'Smart robot vacuum', volume: 12800, growth: 22 },
            { term: 'Robot vacuum self-emptying', volume: 9500, growth: 45 }
          ];
          chartType = 'bar';
          chartTitle = 'Top Search Terms by Volume';
          insights = [
            { title: 'Growth Trend', description: 'Self-emptying functionality shows the highest growth at 45%, indicating strong consumer interest in this feature.' },
            { title: 'Volume Insights', description: 'Pet hair specific searches represent the highest volume, suggesting a key consumer pain point.' }
          ];
          recommendations = [
            'Prioritize pet hair capabilities in product marketing',
            'Highlight self-emptying features in upcoming campaigns',
            'Create content addressing mop functionality to capture growing interest'
          ];
        } else if (module === 'koc') {
          // KOC module mock data
          data = [
            { platform: 'YouTube', engagement: 4.2, reach: 250000, conversion: 1.8 },
            { platform: 'Instagram', engagement: 3.5, reach: 180000, conversion: 1.2 },
            { platform: 'TikTok', engagement: 5.8, reach: 320000, conversion: 2.1 },
            { platform: 'Facebook', engagement: 2.7, reach: 150000, conversion: 0.9 },
            { platform: 'Twitter', engagement: 2.1, reach: 85000, conversion: 0.5 }
          ];
          chartType = 'bar';
          chartTitle = 'KOC Platform Performance Metrics';
          insights = [
            { title: 'TikTok Dominance', description: 'TikTok shows the highest engagement (5.8%) and conversion rates (2.1%), making it the most effective platform for KOC activities.' },
            { title: 'Platform Efficiency', description: 'YouTube offers good balance between reach and conversion, providing cost-effective results.' }
          ];
          recommendations = [
            'Increase TikTok content creator partnerships',
            'Focus YouTube strategy on detailed product demonstrations',
            'Optimize Instagram content for higher engagement rates'
          ];
        } else if (module === 'feeds') {
          // Feeds module mock data
          data = [
            { channel: 'YouTube Ads', ctr: 3.2, cpc: 1.25, conversion: 2.8 },
            { channel: 'Instagram Ads', ctr: 2.7, cpc: 1.40, conversion: 2.2 },
            { channel: 'Facebook Ads', ctr: 2.1, cpc: 0.95, conversion: 1.9 },
            { channel: 'Google Search', ctr: 3.8, cpc: 1.55, conversion: 3.5 },
            { channel: 'Amazon PPC', ctr: 3.2, cpc: 1.60, conversion: 5.2 }
          ];
          chartType = 'bar';
          chartTitle = 'Ad Channel Performance Metrics';
          insights = [
            { title: 'Amazon Conversion Rate', description: 'Amazon PPC has the highest conversion rate at 5.2%, significantly outperforming other channels.' },
            { title: 'Cost Efficiency', description: 'Facebook offers the lowest CPC at $0.95, making it a cost-effective channel for broad reach.' }
          ];
          recommendations = [
            'Increase budget allocation for Amazon PPC campaigns',
            'Optimize Google Search ad copy to improve already strong conversion rates',
            'Use Facebook for awareness campaigns due to low cost per click'
          ];
        } else if (module === 'private') {
          // Private module mock data
          data = [
            { source: 'Direct', traffic: 35 },
            { source: 'Email', traffic: 25 },
            { source: 'WhatsApp', traffic: 15 },
            { source: 'Social Media', traffic: 20 },
            { source: 'Other', traffic: 5 }
          ];
          chartType = 'pie';
          chartTitle = 'DTC Website Traffic Sources';
          insights = [
            { title: 'Direct Traffic Insight', description: 'Direct traffic accounts for 35% of DTC visits, indicating strong brand recognition.' },
            { title: 'Private Channels', description: 'Combined private channels (Email + WhatsApp) drive 40% of traffic, demonstrating the effectiveness of owned media.' }
          ];
          recommendations = [
            'Strengthen email marketing with personalized product recommendations',
            'Expand WhatsApp group strategy to increase private channel traffic',
            'Implement cohesive messaging across all private domain touchpoints'
          ];
        }
        
        return {
          data: data,
          chartType: chartType,
          chartTitle: chartTitle,
          insights: insights,
          recommendations: recommendations
        };
      }
      
      // Initialize the first module
      updateSubmenu(currentModule);
      updateQuestions(currentModule, currentSubModule);
      
      // Research module variables
      const researchContainer = document.getElementById('research-container');
      const researchTabs = document.querySelectorAll('.research-tabs .tab');
      const tabContents = document.querySelectorAll('.tab-content');
      
      // Deep Search Module Functionality
      // é‡ç”¨å·²æœ‰çš„navItemså˜é‡ï¼Œè€Œä¸æ˜¯é‡æ–°å£°æ˜Ž
      const moduleContent = document.getElementById('module-content');
      const deepSearchContainer = document.getElementById('deep-search-container');
      const runTaskBtn = document.getElementById('runTaskBtn');
      const taskInput = document.getElementById('taskInput');
      const modelSelect = document.getElementById('modelSelect');
      const eufyAnalysisBtn = document.getElementById('eufyAnalysisBtn');
      const resultCard = document.getElementById('resultCard');
      const taskResult = document.getElementById('taskResult');
      const generatedCode = document.getElementById('generatedCode');
      const copyCodeBtn = document.getElementById('copyCodeBtn');
      const taskHistory = document.getElementById('taskHistory');
      
      // Deep Search and Research module functionality is now integrated into the main navigation handler above
      
      // Eufy Analysis preset button click handler
      eufyAnalysisBtn.addEventListener('click', function() {
        taskInput.value = "Eufyæ‰«åœ°æœºå™¨äººäº§å“æœ€è¿‘3ä¸ªæœˆï¼ˆ2025å¹´1æœˆ1æ—¥è‡³3æœˆ31æ—¥ï¼‰åœ¨ç¤¾åª’ï¼ˆYoutubeã€Instagramã€TikTokï¼‰çš„è¡¨çŽ°æƒ…å†µï¼Œä»¥åŠåŒç±»äº§å“çš„ç«žå“æƒ…å†µåˆ†æžã€‚";
        modelSelect.value = "gpt-4o";
      });
      
      // Run task button click handler
      runTaskBtn.addEventListener('click', function() {
        const task = taskInput.value.trim();
        const model = modelSelect.value;
        
        if (!task) {
          alert('Please enter a task description');
          return;
        }
        
        // Show result card and code container
        resultCard.style.display = 'block';
        codeContainer.style.display = 'block';
        
        // Show loading state
        taskResult.innerHTML = '<div class="loading-indicator"><div class="spinner"></div><p>Processing your task...</p></div>';
        
        // Generate and display the Python code
        generatedCode.textContent = generatePythonCode(task, model);
        
        // Simulate API call with timeout
        setTimeout(() => {
          // If it's the Eufy analysis task, show a special result
          if (task.includes("Eufyæ‰«åœ°æœºå™¨äººäº§å“æœ€è¿‘3ä¸ªæœˆ") && task.includes("ç¤¾åª’")) {
            taskResult.innerHTML = `
              <h4>Eufy Robot Vacuum Social Media Analysis (Q1 2025)</h4>
              <div class="analysis-result">
                <h5>YouTube Performance</h5>
                <ul>
                  <li>Total views: 2.8M (â†‘12% from Q4 2024)</li>
                  <li>Engagement rate: 4.2% (industry avg: 3.1%)</li>
                  <li>Top performing content: "Eufy X9 Pro vs Roomba j9+" (780K views)</li>
                  <li>Growth in "unboxing" and "review" videos: +18% YoY</li>
                </ul>
                
                <h5>Instagram Performance</h5>
                <ul>
                  <li>Follower growth: +15K (total: 425K)</li>
                  <li>Average engagement per post: 12.3K</li>
                  <li>Most successful campaign: "Clean Home Challenge" (22K user-generated posts)</li>
                  <li>Hashtag #EufyRoboVac reached 1.2M posts</li>
                </ul>
                
                <h5>TikTok Performance</h5>
                <ul>
                  <li>Total video views: 12.5M</li>
                  <li>Average view duration: 18 seconds</li>
                  <li>Viral content: "Eufy vs Cat" series (3.2M views)</li>
                  <li>Creator collaborations: 28 (combined reach: 8.5M)</li>
                </ul>
                
                <h5>Competitive Analysis</h5>
                <ul>
                  <li>Market position: #3 in social media mentions (behind Roomba and Roborock)</li>
                  <li>Unique selling points most mentioned: "Quiet operation" and "No subscription required"</li>
                  <li>Competitive gap: Less content around mapping technology compared to competitors</li>
                  <li>Growth opportunity: More educational content about AI navigation features</li>
                </ul>
                
                <h5>Recommendations</h5>
                <ul>
                  <li>Increase TikTok presence with more short-form content highlighting unique features</li>
                  <li>Expand the successful "Clean Home Challenge" to YouTube with longer tutorials</li>
                  <li>Address the mapping technology gap with comparative demonstrations</li>
                  <li>Leverage positive sentiment around "subscription-free" model in marketing materials</li>
                </ul>
              </div>
              <p><strong>Note:</strong> The above analysis was generated based on the preset task. To execute this task with real-time data using Browser Use, copy and run the generated code.</p>
            `;
          } else {
            // For other tasks, show a generic success message
            taskResult.innerHTML = `
              <p><strong><i class="fas fa-check-circle"></i> Task prepared successfully!</strong></p>
              <p>Your task: ${escapeHtml(task)}</p>
              <p>Selected model: ${model}</p>
              <p>To execute this task, copy the generated code below and run it in your terminal.</p>
            `;
          }
          
          // Add to task history (only once)
          addTaskToHistory(task, model);
        }, 1500);
      });
      
      // Copy code button click handler
      copyCodeBtn.addEventListener('click', function() {
        const code = generatedCode.textContent;
        navigator.clipboard.writeText(code).then(() => {
          // Change button text temporarily
          const originalText = this.innerHTML;
          this.innerHTML = '<i class="fas fa-check"></i> Copied!';
          setTimeout(() => {
            this.innerHTML = originalText;
          }, 2000);
        });
      });
      
      // Generate Python code for the task
      function generatePythonCode(task, model) {
        return `from langchain_openai import ChatOpenAI
from browser_use import Agent
import asyncio
from dotenv import load_dotenv
import os

async def main():
    load_dotenv()
    agent = Agent(
        task="${escapeForCode(task)}",
        llm=ChatOpenAI(model="${model}")
    )
    result = await agent.run()
    print(result)

asyncio.run(main())`;
      }
      
      // Add task to history
      function addTaskToHistory(task, model) {
        // Clear 'No task history yet' message if present
        if (taskHistory.innerHTML.includes('No task history yet')) {
          taskHistory.innerHTML = '';
        }
        
        const now = new Date();
        const timestamp = `${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
        
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        historyItem.innerHTML = `
          <div class="history-item-title">${escapeHtml(task.length > 50 ? task.substring(0, 50) + '...' : task)}</div>
          <div class="history-item-meta">
            <span>${model}</span>
            <span>${timestamp}</span>
          </div>
        `;
        
        // Add click event to reload this task
        historyItem.addEventListener('click', function() {
          taskInput.value = task;
          modelSelect.value = model;
          window.scrollTo(0, deepSearchContainer.offsetTop - 20);
        });
        
        // Add to the beginning of history
        taskHistory.insertBefore(historyItem, taskHistory.firstChild);
        
        // Limit history to 10 items
        if (taskHistory.children.length > 10) {
          taskHistory.removeChild(taskHistory.lastChild);
        }
        
        // Save to localStorage
        saveTaskHistory();
      }
      
      // Save task history to localStorage
      function saveTaskHistory() {
        const historyItems = taskHistory.querySelectorAll('.history-item');
        const history = [];
        
        historyItems.forEach(item => {
          const title = item.querySelector('.history-item-title').textContent;
          const meta = item.querySelector('.history-item-meta').textContent.split('\n');
          const model = meta[0].trim();
          const timestamp = meta[1].trim();
          
          history.push({
            task: title.endsWith('...') ? taskInput.value : title,
            model: model,
            timestamp: timestamp
          });
        });
        
        localStorage.setItem('eufyDeepSearchHistory', JSON.stringify(history));
      }
      
      // Load task history from localStorage
      function loadTaskHistory() {
        const savedHistory = localStorage.getItem('eufyDeepSearchHistory');
        
        if (savedHistory) {
          const history = JSON.parse(savedHistory);
          
          if (history.length > 0) {
            taskHistory.innerHTML = '';
            
            history.forEach(item => {
              addTaskToHistory(item.task, item.model);
            });
          }
        }
      }
      
      // Helper function to escape HTML
      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
      
      // Helper function to escape code
      function escapeForCode(text) {
        return text.replace(/\\/g, '\\\\').replace(/"/g, '\\"').replace(/\n/g, '\\n');
      }
      
      // Load task history on page load
      loadTaskHistory();
      
      // Research module tab functionality
      researchTabs.forEach(tab => {
        tab.addEventListener('click', function() {
          const tabId = this.dataset.tab;
          
          // Update active tab
          researchTabs.forEach(t => t.classList.remove('active'));
          this.classList.add('active');
          
          // Hide all tab contents
          tabContents.forEach(content => {
            content.style.display = 'none';
          });
          
          // Show selected tab content
          document.getElementById(`${tabId}-content`).style.display = 'block';
        });
      });
      
      // Agent Settings functionality
      const saveAgentSettingsBtn = document.getElementById('saveAgentSettingsBtn');
      if (saveAgentSettingsBtn) {
        saveAgentSettingsBtn.addEventListener('click', function() {
          const agentMode = document.getElementById('agentMode').value;
          const agentTimeout = document.getElementById('agentTimeout').value;
          const agentMaxSteps = document.getElementById('agentMaxSteps').value;
          
          // Save settings (in a real implementation, this would save to server or localStorage)
          alert('Agent settings saved successfully!');
        });
      }
      
      // LLM Settings functionality
      const saveLLMSettingsBtn = document.getElementById('saveLLMSettingsBtn');
      if (saveLLMSettingsBtn) {
        saveLLMSettingsBtn.addEventListener('click', function() {
          const defaultLLM = document.getElementById('defaultLLM').value;
          const defaultModel = document.getElementById('defaultModel').value;
          const temperature = document.getElementById('temperature').value;
          
          // Save settings
          alert('LLM settings saved successfully!');
        });
      }
      
      // Temperature slider value display
      const temperatureSlider = document.getElementById('temperature');
      const temperatureValue = document.getElementById('temperatureValue');
      if (temperatureSlider && temperatureValue) {
        temperatureSlider.addEventListener('input', function() {
          temperatureValue.textContent = this.value;
        });
      }
      
      // Browser Settings functionality
      const saveBrowserSettingsBtn = document.getElementById('saveBrowserSettingsBtn');
      if (saveBrowserSettingsBtn) {
        saveBrowserSettingsBtn.addEventListener('click', function() {
          const browserType = document.getElementById('browserType').value;
          const headless = document.getElementById('headless').value;
          const userAgent = document.getElementById('userAgent').value;
          const viewportWidth = document.getElementById('viewportWidth').value;
          const viewportHeight = document.getElementById('viewportHeight').value;
          
          // Save settings
          alert('Browser settings saved successfully!');
        });
      }
      
      // Run Agent functionality
      const runAgentBtn = document.getElementById('runAgentBtn');
      const agentResultCard = document.getElementById('agentResultCard');
      const agentResult = document.getElementById('agentResult');
      if (runAgentBtn) {
        runAgentBtn.addEventListener('click', function() {
          const agentTask = document.getElementById('agentTask').value.trim();
          const agentModel = document.getElementById('agentModel').value;
          
          if (!agentTask) {
            alert('Please enter a task description');
            return;
          }
          
          // Show result card and loading state
          agentResultCard.style.display = 'block';
          agentResult.innerHTML = '<div class="loading-indicator"><div class="spinner"></div><p>Agent is working on your task...</p></div>';
          
          // Simulate agent execution
          setTimeout(() => {
            agentResult.innerHTML = `
              <h4>Task Completed</h4>
              <p><strong>Task:</strong> ${escapeHtml(agentTask)}</p>
              <p><strong>Model:</strong> ${agentModel}</p>
              <div class="note-box">
                <p>The browser agent has completed the task. In a real implementation, this would show the actual results from the browser-use agent.</p>
              </div>
            `;
          }, 3000);
        });
      }
      
      // Deep Research functionality
      const startResearchBtn = document.getElementById('startResearchBtn');
      const researchResultCard = document.getElementById('researchResultCard');
      const researchResult = document.getElementById('researchResult');
      if (startResearchBtn) {
        startResearchBtn.addEventListener('click', function() {
          const researchTopic = document.getElementById('researchTopic').value.trim();
          const researchDepth = document.getElementById('researchDepth').value;
          const researchModel = document.getElementById('researchModel').value;
          
          if (!researchTopic) {
            alert('Please enter a research topic');
            return;
          }
          
          // Show result card and loading state
          researchResultCard.style.display = 'block';
          researchResult.innerHTML = '<div class="loading-indicator"><div class="spinner"></div><p>Conducting deep research...</p></div>';
          
          // Simulate research execution
          setTimeout(() => {
            researchResult.innerHTML = `
              <h4>Research Completed</h4>
              <p><strong>Topic:</strong> ${escapeHtml(researchTopic)}</p>
              <p><strong>Depth:</strong> ${researchDepth}</p>
              <p><strong>Model:</strong> ${researchModel}</p>
              <div class="note-box">
                <p>The deep research has been completed. In a real implementation, this would show the actual research results.</p>
              </div>
            `;
          }, 5000);
        });
      }
    });
  </script>
  <!-- å¯¼å…¥è‡ªå®šä¹‰JS -->
  <script src="js/main.js"></script>
